# 要件定義書

## 目的

ストレージ内の巨大なディレクトリやファイルを高速に検出し，ディスク逼迫の原因を特定する CLI ツール．
開発者・システム管理者が日常的に使用できる，インストール不要な単一バイナリとして提供する．

## 機能要件

### FR-01: OS 判別とターゲットパス自動認識

- Windows のドライブレター（C:, D: 等）および Linux / macOS のルートパス（`/`）を自動認識すること．
- ユーザーが任意のパスを引数で指定できること．
- 存在しないパスを指定された場合はエラーメッセージを表示して終了すること．

### FR-02: 高速並列スキャン

- Goroutine を用いた Worker Pool 方式により，I/O 待ち時間を最小化して並列でディレクトリを走査すること．
- デフォルトの Worker 数は実行マシンの CPU コア数に応じて自動設定すること．
- ユーザーが `-w` フラグで Worker 数を任意に指定できること．

### FR-03: サイズ集計と分析表示

- 指定パス配下の各ディレクトリの合計サイズ（再帰的に集計）を算出すること．
- サイズ上位 N 件を降順で表示すること（デフォルト N=20，`-n` フラグで変更可）．
- サイズを人間が読みやすい単位（B / KB / MB / GB / TB）に自動変換して表示すること．

### FR-04: エラー耐性

- アクセス拒否（権限エラー）のディレクトリは警告なしにスキップし，残りの走査を継続すること．
- シンボリックリンクを追いかけず，無限ループを防止すること．

### FR-05: 進捗表示

- スキャン中のリアルタイム進捗（スキャン済みディレクトリ数）を標準エラー出力に表示すること．
- 完了後，経過時間とスキャンしたディレクトリ総数を表示すること．

## 非機能要件

### NFR-01: メモリ効率

- 数百万ファイル規模のファイルシステムでも，ヒープ使用量が 512 MB を超えないこと．
- ストリーミング処理を基本とし，全データをメモリに保持しないこと．

### NFR-02: パフォーマンス

- 1,000 万ファイルのスキャンを HDD 環境で 60 秒以内，SSD 環境で 30 秒以内に完了すること（目安）．

### NFR-03: 配布性

- Go のクロスコンパイル機能を活かし，単一バイナリで配布可能であること．
- 外部依存ライブラリを持たず，Go 標準ライブラリのみで実装すること．

### NFR-04: 保守性

- `internal/` パッケージによるモジュール分離で，各コンポーネントを独立してテスト可能にすること．
- 主要ロジックにユニットテストを整備すること（カバレッジ 70% 以上を目安）．

## 制約

- Go 1.21 以上を対象とする．
- 対応 OS: Windows 10+，Linux（カーネル 4.4+），macOS 12+．
- CGO 不使用（`CGO_ENABLED=0` でビルド可能）．
